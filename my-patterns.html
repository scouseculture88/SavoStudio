<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Pattern Collection - Savo Mode</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298, #1e3c72);
            color: white;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #00d2ff, #3a7bd5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #00d2ff;
            margin-bottom: 5px;
        }

        .creation-tools {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .pattern-creator {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .creator-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            color: white;
            font-size: 14px;
        }

        .color-picker-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .color-input {
            aspect-ratio: 1;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
        }

        .pattern-preview-large {
            height: 200px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background-size: 50px 50px;
            position: relative;
            overflow: hidden;
        }

        .generation-progress {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            z-index: 10;
        }

        .progress-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #00d2ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .progress-bar-container {
            width: 80%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00d2ff, #3a7bd5, #00d2ff);
            background-size: 200% 100%;
            animation: progressFlow 2s ease-in-out infinite;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            color: white;
            font-size: 0.9rem;
            text-align: center;
            opacity: 0.9;
        }

        .progress-steps {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .progress-step {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: #00d2ff;
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(0, 210, 255, 0.5);
        }

        .progress-step.completed {
            background: #2ecc71;
            transform: scale(1.1);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes progressFlow {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .pattern-generation-complete {
            animation: patternReveal 0.8s ease-out;
        }

        @keyframes patternReveal {
            0% {
                opacity: 0;
                transform: scale(0.9);
                filter: blur(5px);
            }
            100% {
                opacity: 1;
                transform: scale(1);
                filter: blur(0);
            }
        }

        .pattern-example-card:hover {
            transform: scale(1.05) !important;
            border-color: rgba(0, 210, 255, 0.6) !important;
            box-shadow: 0 5px 15px rgba(0, 210, 255, 0.3);
        }

        .pattern-example-card.selected {
            border-color: #00d2ff !important;
            transform: scale(1.05) !important;
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.5);
        }

        .btn {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 210, 255, 0.4);
        }

        .btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .my-patterns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .pattern-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .pattern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 210, 255, 0.3);
            border-color: rgba(0, 210, 255, 0.5);
        }

        .pattern-card.selected {
            border-color: #00d2ff;
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.5);
        }

        .pattern-preview {
            height: 150px;
            background-size: 50px 50px;
            position: relative;
        }

        .pattern-overlay {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 0 0 0 10px;
            font-size: 0.8rem;
        }

        .pattern-info {
            padding: 15px;
        }

        .pattern-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .pattern-details {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .pattern-colors {
            display: flex;
            gap: 3px;
            margin-bottom: 10px;
        }

        .color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .pattern-actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: rgba(0, 210, 255, 0.3);
        }

        .filter-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn:hover, .filter-btn.active {
            background: rgba(0, 210, 255, 0.2);
            border-color: #00d2ff;
        }

        .search-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            min-width: 200px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.7;
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: #00d2ff;
        }

        .pattern-example-card:hover .pattern-actions {
            opacity: 1 !important;
        }

        /* Mobile support - show buttons on touch devices */
        @media (hover: none) and (pointer: coarse) {
            .pattern-actions {
                opacity: 0.8 !important;
            }
        }

        @media (max-width: 768px) {
            .pattern-creator {
                grid-template-columns: 1fr;
            }
            
            .color-picker-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .my-patterns-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>My Pattern Collection</h1>
            <p>Create, save, and manage your tactical pattern library</p>
        </div>

        <!-- Statistics Overview -->
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-number" id="totalSaved">0</div>
                <div>Total Patterns</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCategories">0</div>
                <div>Categories</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="recentlyCreated">0</div>
                <div>This Week</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="challengeProgress">0/500</div>
                <div>Challenge Progress</div>
            </div>
        </div>

        <!-- Pattern Creator -->
        <div class="creation-tools">
            <h2>Create New Pattern</h2>
            <div class="pattern-creator">
                <div class="creator-section">
                    <h3>Pattern Details</h3>
                    <div class="form-group">
                        <label>Pattern Name</label>
                        <input type="text" id="patternName" placeholder="e.g., Liquid Amber Forest">
                    </div>
                    
                    <div class="form-group">
                        <label>Category</label>
                        <select id="patternCategory">
                            <option value="forest">Forest</option>
                            <option value="desert">Desert</option>
                            <option value="urban">Urban</option>
                            <option value="mountain">Mountain</option>
                            <option value="jungle">Jungle</option>
                            <option value="arctic">Arctic</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Pattern Type</label>
                        <select id="patternType">
                            <option value="digital">Digital Camo</option>
                            <option value="woodland">Woodland</option>
                            <option value="geometric">Geometric</option>
                            <option value="organic">Organic</option>
                            <option value="hybrid">Hybrid</option>
                            <option value="symbols">Symbol Camo</option>
                            <option value="pixelated">Pixelated</option>
                            <option value="fractured">Fractured</option>
                            <option value="tiger">Tiger Stripe</option>
                            <option value="dazzle">Dazzle Camo</option>
                            <option value="urban-tech">Urban Tech</option>
                            <option value="hex-pattern">Hex Pattern</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Description/Notes</label>
                        <textarea id="patternDescription" placeholder="Describe your pattern inspiration, use case, or special features..."></textarea>
                    </div>
                </div>
                
                <div class="creator-section">
                    <h3>Color Palette</h3>
                    <div class="color-picker-grid">
                        <input type="color" class="color-input" id="color1" value="#2d5016">
                        <input type="color" class="color-input" id="color2" value="#3d6b1f">
                        <input type="color" class="color-input" id="color3" value="#4a7c28">
                        <input type="color" class="color-input" id="color4" value="#d4af37">
                        <input type="color" class="color-input" id="color5" value="#cd853f">
                    </div>
                    
                    <div class="pattern-preview-large" id="patternPreview">
                        <div class="generation-progress" id="generationProgress">
                            <div class="progress-spinner"></div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progressBar"></div>
                            </div>
                            <div class="progress-text" id="progressText">Analyzing colors...</div>
                            <div class="progress-steps">
                                <div class="progress-step" id="step1"></div>
                                <div class="progress-step" id="step2"></div>
                                <div class="progress-step" id="step3"></div>
                                <div class="progress-step" id="step4"></div>
                                <div class="progress-step" id="step5"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn" onclick="generatePreview()">Update Preview</button>
                        <button class="btn" onclick="savePattern()">Save Pattern</button>
                        <button class="btn secondary" onclick="randomizeColors()">Random Colors</button>
                        <button class="btn" onclick="loadNikeForestColors()" style="background: linear-gradient(135deg, #4a6741, #7cff50);">Nike Forest Camo</button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4 style="text-align: center; margin-bottom: 15px;">Pattern Style Library - Click Any Style</h4>
                        <div class="pattern-examples" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px;">
                            <div class="pattern-example-card" onclick="selectPatternStyle('digital')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-conic-gradient(#4a6741 0deg 72deg, #5c7a52 72deg 144deg, #3d5436 144deg 216deg, #7cff50 216deg 288deg, #2d4027 288deg); background-size: 25px 25px;"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Digital</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('woodland')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-linear-gradient(45deg, #4a6741, #4a6741 8px, #5c7a52 8px, #5c7a52 16px, #3d5436 16px, #3d5436 24px);"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Woodland</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('symbols')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: radial-gradient(circle at 20% 20%, #4a6741 3px, transparent 3px), radial-gradient(circle at 60% 40%, #5c7a52 2px, transparent 2px), radial-gradient(circle at 40% 70%, #3d5436 4px, transparent 4px), linear-gradient(45deg, #7cff50 50%, transparent 50%); background-size: 15px 15px;"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Symbol</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('tiger')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-linear-gradient(0deg, #2d4027 0px, #2d4027 3px, #4a6741 3px, #4a6741 5px, #5c7a52 5px, #5c7a52 8px, #3d5436 8px, #3d5436 10px, #7cff50 10px, #7cff50 13px);"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Tiger</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('fractured')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: conic-gradient(from 30deg at 50% 50%, #4a6741 0deg, #5c7a52 72deg, #3d5436 144deg, #7cff50 216deg, #2d4027 288deg, #4a6741 360deg);"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Fractured</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('dazzle')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: linear-gradient(45deg, #4a6741 25%, transparent 25%, transparent 75%, #5c7a52 75%, #5c7a52), linear-gradient(-45deg, #3d5436 25%, transparent 25%, transparent 75%, #7cff50 75%, #7cff50);"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Dazzle</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('urban-tech')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-linear-gradient(90deg, #4a6741, #4a6741 1px, #5c7a52 1px, #5c7a52 2px), repeating-linear-gradient(0deg, #3d543688, #3d543688 2px, #7cff5088 2px, #7cff5088 4px);"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Urban Tech</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('hex-pattern')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-conic-gradient(from 0deg at 50% 50%, #4a6741 0deg 60deg, #5c7a52 60deg 120deg, #3d5436 120deg 180deg, #7cff50 180deg 240deg, #2d4027 240deg 300deg, #4a6741 300deg 360deg); background-size: 20px 20px;"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Hex</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('pixelated')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease; position: relative;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-conic-gradient(#4a6741 0deg 90deg, #5c7a52 90deg 180deg, #3d5436 180deg 270deg, #7cff50 270deg 360deg); background-size: 12px 12px;"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Pixel</div>
                                <div class="pattern-actions" style="position: absolute; top: 2px; right: 2px; display: flex; gap: 2px; opacity: 0; transition: opacity 0.3s;">
                                    <button onclick="event.stopPropagation(); viewPatternStyle('pixelated'); return false;" style="background: rgba(0,210,255,0.8); border: none; color: white; padding: 2px 4px; border-radius: 3px; font-size: 0.6rem; cursor: pointer;">View</button>
                                    <button onclick="event.stopPropagation(); exportPatternStyle('pixelated'); return false;" style="background: rgba(40,167,69,0.8); border: none; color: white; padding: 2px 4px; border-radius: 3px; font-size: 0.6rem; cursor: pointer;">Export</button>
                                </div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('geometric')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease; position: relative;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-conic-gradient(from 45deg, #4a6741 0deg 45deg, #5c7a52 45deg 90deg, #3d5436 90deg 135deg, #7cff50 135deg 180deg); background-size: 18px 18px;"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Geometric</div>
                                <div class="pattern-actions" style="position: absolute; top: 2px; right: 2px; display: flex; gap: 2px; opacity: 0; transition: opacity 0.3s;">
                                    <button onclick="event.stopPropagation(); viewPatternStyle('geometric'); return false;" style="background: rgba(0,210,255,0.8); border: none; color: white; padding: 2px 4px; border-radius: 3px; font-size: 0.6rem; cursor: pointer;">View</button>
                                    <button onclick="event.stopPropagation(); exportPatternStyle('geometric'); return false;" style="background: rgba(40,167,69,0.8); border: none; color: white; padding: 2px 4px; border-radius: 3px; font-size: 0.6rem; cursor: pointer;">Export</button>
                                </div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('organic')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-radial-gradient(ellipse, #4a6741 0px, #5c7a52 12px, #3d5436 24px, #7cff50 36px);"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Organic</div>
                            </div>
                            <div class="pattern-example-card" onclick="selectPatternStyle('hybrid')" style="cursor: pointer; border-radius: 8px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease;">
                                <div class="pattern-example-preview" style="height: 50px; background: repeating-linear-gradient(30deg, #4a6741, #5c7a52 10px, #3d5436 20px, #7cff50 30px, #2d4027 40px);"></div>
                                <div style="padding: 6px; text-align: center; font-size: 0.7rem;">Hybrid</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter and Search -->
        <div class="creation-tools">
            <h2>My Saved Patterns</h2>
            <div class="filter-section">
                <div class="filter-btn active" onclick="filterPatterns('all')">All</div>
                <div class="filter-btn" onclick="filterPatterns('forest')">Forest</div>
                <div class="filter-btn" onclick="filterPatterns('desert')">Desert</div>
                <div class="filter-btn" onclick="filterPatterns('urban')">Urban</div>
                <div class="filter-btn" onclick="filterPatterns('custom')">Custom</div>
                <input type="text" class="search-box" placeholder="Search patterns..." onkeyup="searchPatterns(this.value)">
                <button class="btn secondary" onclick="exportAllPatterns()">Export All</button>
                <button class="btn secondary" onclick="importPatterns()">Import</button>
            </div>

            <!-- Patterns Grid -->
            <div class="my-patterns-grid" id="patternsGrid">
                <div class="empty-state">
                    <h3>No patterns yet!</h3>
                    <p>Create your first pattern using the tool above, or import existing patterns from your collection.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class PatternManager {
            constructor() {
                this.patterns = JSON.parse(localStorage.getItem('savoModePatterns') || '[]');
                this.currentFilter = 'all';
                this.selectedPattern = null;
                
                this.initializeEventListeners();
                this.loadPatterns();
                this.updateStats();
                this.updatePreview();
            }

            initializeEventListeners() {
                // Color picker change events
                for (let i = 1; i <= 5; i++) {
                    document.getElementById(`color${i}`).addEventListener('change', () => {
                        this.updatePreview();
                    });
                }
            }

            updatePreview() {
                const colors = [];
                for (let i = 1; i <= 5; i++) {
                    colors.push(document.getElementById(`color${i}`).value);
                }
                
                const preview = document.getElementById('patternPreview');
                const type = document.getElementById('patternType').value;
                
                // Show animated progress
                this.showGenerationProgress();
                
                let pattern;
                switch (type) {
                    case 'digital':
                        pattern = `repeating-conic-gradient(${colors[0]} 0deg 72deg, ${colors[1]} 72deg 144deg, ${colors[2]} 144deg 216deg, ${colors[3]} 216deg 288deg, ${colors[4]} 288deg)`;
                        break;
                    case 'woodland':
                        pattern = `repeating-linear-gradient(45deg, ${colors[0]}, ${colors[0]} 10px, ${colors[1]} 10px, ${colors[1]} 20px, ${colors[2]} 20px, ${colors[2]} 30px)`;
                        break;
                    case 'geometric':
                        pattern = `repeating-conic-gradient(from 45deg, ${colors[0]} 0deg 45deg, ${colors[1]} 45deg 90deg, ${colors[2]} 90deg 135deg, ${colors[3]} 135deg 180deg)`;
                        break;
                    case 'organic':
                        pattern = `repeating-radial-gradient(ellipse, ${colors[0]} 0px, ${colors[1]} 20px, ${colors[2]} 40px, ${colors[3]} 60px)`;
                        break;
                    case 'symbols':
                        pattern = `radial-gradient(circle at 20% 20%, ${colors[0]} 8px, transparent 8px), 
                                  radial-gradient(circle at 60% 40%, ${colors[1]} 6px, transparent 6px),
                                  radial-gradient(circle at 40% 70%, ${colors[2]} 10px, transparent 10px),
                                  radial-gradient(circle at 80% 80%, ${colors[3]} 7px, transparent 7px),
                                  linear-gradient(45deg, ${colors[4]} 50%, transparent 50%)`;
                        break;
                    case 'pixelated':
                        pattern = `repeating-conic-gradient(${colors[0]} 0deg 90deg, ${colors[1]} 90deg 180deg, ${colors[2]} 180deg 270deg, ${colors[3]} 270deg 360deg)`;
                        break;
                    case 'fractured':
                        pattern = `conic-gradient(from 30deg at 50% 50%, ${colors[0]} 0deg, ${colors[1]} 72deg, ${colors[2]} 144deg, ${colors[3]} 216deg, ${colors[4]} 288deg, ${colors[0]} 360deg),
                                  repeating-linear-gradient(135deg, transparent, transparent 15px, ${colors[1]}33 15px, ${colors[1]}33 30px)`;
                        break;
                    case 'tiger':
                        pattern = `repeating-linear-gradient(0deg, ${colors[0]} 0px, ${colors[0]} 8px, ${colors[1]} 8px, ${colors[1]} 12px, ${colors[2]} 12px, ${colors[2]} 20px, ${colors[3]} 20px, ${colors[3]} 24px, ${colors[4]} 24px, ${colors[4]} 32px)`;
                        break;
                    case 'dazzle':
                        pattern = `linear-gradient(45deg, ${colors[0]} 25%, transparent 25%, transparent 75%, ${colors[1]} 75%, ${colors[1]}),
                                  linear-gradient(-45deg, ${colors[2]} 25%, transparent 25%, transparent 75%, ${colors[3]} 75%, ${colors[3]}),
                                  linear-gradient(90deg, ${colors[4]}66, ${colors[0]}66)`;
                        break;
                    case 'urban-tech':
                        pattern = `repeating-linear-gradient(90deg, ${colors[0]}, ${colors[0]} 2px, ${colors[1]} 2px, ${colors[1]} 4px),
                                  repeating-linear-gradient(0deg, ${colors[2]}88, ${colors[2]}88 6px, ${colors[3]}88 6px, ${colors[3]}88 12px),
                                  radial-gradient(circle at 25% 25%, ${colors[4]}44 20px, transparent 20px)`;
                        break;
                    case 'hex-pattern':
                        pattern = `repeating-conic-gradient(from 0deg at 50% 50%, ${colors[0]} 0deg 60deg, ${colors[1]} 60deg 120deg, ${colors[2]} 120deg 180deg, ${colors[3]} 180deg 240deg, ${colors[4]} 240deg 300deg, ${colors[0]} 300deg 360deg)`;
                        break;
                    default:
                        pattern = `repeating-linear-gradient(30deg, ${colors[0]}, ${colors[1]} 15px, ${colors[2]} 30px, ${colors[3]} 45px, ${colors[4]} 60px)`;
                }
                
                // Simulate pattern generation delay for progress animation
                setTimeout(() => {
                    preview.style.background = pattern;
                    preview.classList.add('pattern-generation-complete');
                    this.hideGenerationProgress();
                    
                    setTimeout(() => {
                        preview.classList.remove('pattern-generation-complete');
                    }, 800);
                }, 2000);
            }

            savePattern() {
                const name = document.getElementById('patternName').value;
                const category = document.getElementById('patternCategory').value;
                const type = document.getElementById('patternType').value;
                const description = document.getElementById('patternDescription').value;
                
                if (!name) {
                    this.showNotification('Please enter a pattern name', 'warning');
                    return;
                }
                
                const colors = [];
                for (let i = 1; i <= 5; i++) {
                    colors.push(document.getElementById(`color${i}`).value);
                }
                
                const pattern = {
                    id: Date.now(),
                    name: name,
                    category: category,
                    type: type,
                    description: description,
                    colors: colors,
                    preview: document.getElementById('patternPreview').style.background,
                    created: new Date().toISOString(),
                    tags: this.generateTags(name, category, type)
                };
                
                this.patterns.push(pattern);
                this.saveToStorage();
                this.loadPatterns();
                this.updateStats();
                
                // Clear form
                document.getElementById('patternName').value = '';
                document.getElementById('patternDescription').value = '';
                
                this.showNotification(`Saved "${name}" to your collection!`, 'success');
                
                // Update challenge progress
                this.updateChallengeProgress();
            }

            generateTags(name, category, type) {
                const tags = [category, type];
                const nameWords = name.toLowerCase().split(' ');
                nameWords.forEach(word => {
                    if (word.length > 3 && !tags.includes(word)) {
                        tags.push(word);
                    }
                });
                return tags;
            }

            loadPatterns() {
                console.log('Loading patterns. Total:', this.patterns.length, 'Filter:', this.currentFilter);
                
                const grid = document.getElementById('patternsGrid');
                const filteredPatterns = this.currentFilter === 'all' 
                    ? this.patterns 
                    : this.patterns.filter(p => p.category === this.currentFilter);

                console.log('Filtered patterns:', filteredPatterns.length);

                if (filteredPatterns.length === 0) {
                    grid.innerHTML = `
                        <div class="empty-state">
                            <h3>No patterns in "${this.currentFilter}" category!</h3>
                            <p>Total patterns: ${this.patterns.length} | Try "All" filter or create new patterns.</p>
                            <p style="font-size: 0.8rem; opacity: 0.7;">Debug: ${this.patterns.map(p => p.category).join(', ')}</p>
                        </div>
                    `;
                    return;
                }

                grid.innerHTML = filteredPatterns.map(pattern => `
                    <div class="pattern-card" onclick="patternManager.selectPattern('${pattern.id}')">
                        <div class="pattern-preview" style="background: ${pattern.preview || 'linear-gradient(45deg, ' + pattern.colors.join(', ') + ')'}">
                            <div class="pattern-overlay">${pattern.type || pattern.environment || 'Pattern'}</div>
                        </div>
                        <div class="pattern-info">
                            <div class="pattern-name">${pattern.name}</div>
                            <div class="pattern-details">${pattern.category} • ${new Date(pattern.created).toLocaleDateString()}</div>
                            <div class="pattern-colors">
                                ${pattern.colors.map(color => `<div class="color-dot" style="background: ${color}"></div>`).join('')}
                            </div>
                            <div class="pattern-actions">
                                <button class="action-btn" onclick="event.stopPropagation(); patternManager.editPattern('${pattern.id}')">Edit</button>
                                <button class="action-btn" onclick="event.stopPropagation(); patternManager.duplicatePattern('${pattern.id}')">Copy</button>
                                <button class="action-btn" onclick="event.stopPropagation(); patternManager.deletePattern('${pattern.id}')">Delete</button>
                                <button class="action-btn" onclick="event.stopPropagation(); patternManager.exportSavedPattern('${pattern.id}')">Export</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            selectPattern(patternId) {
                this.selectedPattern = patternId;
                const pattern = this.patterns.find(p => p.id === patternId);
                this.showNotification(`Selected: ${pattern.name}`, 'info');
                
                // Update UI to show selection
                document.querySelectorAll('.pattern-card').forEach(card => {
                    card.classList.remove('selected');
                });
                event.currentTarget.classList.add('selected');
            }

            editPattern(patternId) {
                const pattern = this.patterns.find(p => p.id === patternId);
                
                document.getElementById('patternName').value = pattern.name;
                document.getElementById('patternCategory').value = pattern.category;
                document.getElementById('patternType').value = pattern.type;
                document.getElementById('patternDescription').value = pattern.description;
                
                pattern.colors.forEach((color, index) => {
                    document.getElementById(`color${index + 1}`).value = color;
                });
                
                this.updatePreview();
                this.showNotification(`Editing: ${pattern.name}`, 'info');
            }

            duplicatePattern(patternId) {
                const pattern = this.patterns.find(p => p.id === patternId);
                const duplicate = {
                    ...pattern,
                    id: Date.now(),
                    name: pattern.name + ' (Copy)',
                    created: new Date().toISOString()
                };
                
                this.patterns.push(duplicate);
                this.saveToStorage();
                this.loadPatterns();
                this.updateStats();
                
                this.showNotification(`Duplicated: ${pattern.name}`, 'success');
            }

            deletePattern(patternId) {
                const pattern = this.patterns.find(p => p.id === patternId);
                if (confirm(`Delete "${pattern.name}"? This cannot be undone.`)) {
                    this.patterns = this.patterns.filter(p => p.id !== patternId);
                    this.saveToStorage();
                    this.loadPatterns();
                    this.updateStats();
                    this.showNotification(`Deleted: ${pattern.name}`, 'info');
                }
            }

            filterPatterns(category) {
                this.currentFilter = category;
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                this.loadPatterns();
            }

            searchPatterns(query) {
                // Simple search implementation
                if (!query) {
                    this.loadPatterns();
                    return;
                }
                
                const filteredPatterns = this.patterns.filter(pattern => 
                    pattern.name.toLowerCase().includes(query.toLowerCase()) ||
                    pattern.description.toLowerCase().includes(query.toLowerCase()) ||
                    pattern.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase()))
                );
                
                this.displayFilteredPatterns(filteredPatterns);
            }

            displayFilteredPatterns(patterns) {
                const grid = document.getElementById('patternsGrid');
                if (patterns.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><h3>No patterns found</h3><p>Try a different search term.</p></div>';
                    return;
                }
                
                grid.innerHTML = patterns.map(pattern => `
                    <div class="pattern-card" onclick="patternManager.selectPattern(${pattern.id})">
                        <div class="pattern-preview" style="background: ${pattern.preview}"></div>
                        <div class="pattern-info">
                            <div class="pattern-name">${pattern.name}</div>
                            <div class="pattern-details">${pattern.category} • ${new Date(pattern.created).toLocaleDateString()}</div>
                            <div class="pattern-colors">
                                ${pattern.colors.map(color => `<div class="color-dot" style="background: ${color}"></div>`).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            updateStats() {
                document.getElementById('totalSaved').textContent = this.patterns.length;
                
                const categories = new Set(this.patterns.map(p => p.category));
                document.getElementById('totalCategories').textContent = categories.size;
                
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                const recentPatterns = this.patterns.filter(p => new Date(p.created) > oneWeekAgo);
                document.getElementById('recentlyCreated').textContent = recentPatterns.length;
                
                // Get challenge progress from challenge tracker
                const challengeProgress = localStorage.getItem('patternCount') || 0;
                document.getElementById('challengeProgress').textContent = `${challengeProgress}/500`;
            }

            updateChallengeProgress() {
                // Update the challenge tracker
                const currentCount = parseInt(localStorage.getItem('patternCount') || 0);
                localStorage.setItem('patternCount', currentCount + 1);
                
                const today = new Date().toDateString();
                const dailyProgress = JSON.parse(localStorage.getItem('dailyProgress') || '{}');
                dailyProgress[today] = (dailyProgress[today] || 0) + 1;
                localStorage.setItem('dailyProgress', JSON.stringify(dailyProgress));
                
                this.updateStats();
            }

            exportAllPatterns() {
                const exportData = {
                    patterns: this.patterns,
                    exportDate: new Date().toISOString(),
                    totalPatterns: this.patterns.length
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `savo-mode-patterns-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                this.showNotification('Patterns exported successfully!', 'success');
            }

            showGenerationProgress() {
                const progress = document.getElementById('generationProgress');
                const progressBar = document.getElementById('progressBar');
                const progressText = document.getElementById('progressText');
                
                progress.style.display = 'flex';
                
                const steps = [
                    { text: 'Analyzing colors...', progress: 20 },
                    { text: 'Generating base pattern...', progress: 40 },
                    { text: 'Applying tactical algorithm...', progress: 60 },
                    { text: 'Optimizing camouflage...', progress: 80 },
                    { text: 'Finalizing pattern...', progress: 100 }
                ];
                
                let currentStep = 0;
                const stepInterval = setInterval(() => {
                    if (currentStep < steps.length) {
                        const step = steps[currentStep];
                        progressText.textContent = step.text;
                        progressBar.style.width = step.progress + '%';
                        
                        // Update step indicators
                        const stepElement = document.getElementById(`step${currentStep + 1}`);
                        if (stepElement) {
                            stepElement.classList.add('active');
                            if (currentStep > 0) {
                                document.getElementById(`step${currentStep}`).classList.remove('active');
                                document.getElementById(`step${currentStep}`).classList.add('completed');
                            }
                        }
                        
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                    }
                }, 400);
            }
            
            hideGenerationProgress() {
                const progress = document.getElementById('generationProgress');
                const progressBar = document.getElementById('progressBar');
                
                // Complete all steps
                for (let i = 1; i <= 5; i++) {
                    const step = document.getElementById(`step${i}`);
                    if (step) {
                        step.classList.remove('active');
                        step.classList.add('completed');
                    }
                }
                
                setTimeout(() => {
                    progress.style.display = 'none';
                    progressBar.style.width = '0%';
                    
                    // Reset steps
                    for (let i = 1; i <= 5; i++) {
                        const step = document.getElementById(`step${i}`);
                        if (step) {
                            step.classList.remove('active', 'completed');
                        }
                    }
                }, 500);
            }

            randomizeColors() {
                const presets = [
                    ['#d4af37', '#cd853f', '#b8860b', '#daa520', '#f4a460'], // Liquid amber
                    ['#2d5016', '#3d6b1f', '#4a7c28', '#5d8c2f', '#1a3d0a'], // Forest
                    ['#d4a574', '#c4955f', '#b8895a', '#a67c52', '#8f6b44'], // Desert
                    ['#4a4a4a', '#666666', '#7a7a7a', '#333333', '#595959'], // Urban
                    ['#ff6b35', '#4caf50', '#2e7d32', '#ff8f65', '#66bb6a'], // Dolph style
                    ['#4a6741', '#5c7a52', '#3d5436', '#7cff50', '#2d4027'], // Nike Forest Camo (from your image)
                ];
                
                const randomPreset = presets[Math.floor(Math.random() * presets.length)];
                randomPreset.forEach((color, index) => {
                    document.getElementById(`color${index + 1}`).value = color;
                });
                
                this.updatePreview();
            }

            saveToStorage() {
                localStorage.setItem('savoModePatterns', JSON.stringify(this.patterns));
            }

            exportSavedPattern(patternId) {
                const pattern = this.patterns.find(p => p.id === patternId);
                if (!pattern) return;

                // Create canvas with pattern
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 600;
                const ctx = canvas.getContext('2d');

                // Fill with gradient from pattern colors
                const gradient = ctx.createLinearGradient(0, 0, 800, 600);
                pattern.colors.forEach((color, index) => {
                    gradient.addColorStop(index / (pattern.colors.length - 1), color);
                });
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 800, 600);

                // Add some pattern texture based on type
                this.drawPatternTexture(ctx, pattern, 800, 600);

                // Create Google-style image modal
                const img = document.createElement('img');
                img.src = canvas.toDataURL('image/png', 0.95);
                img.alt = `${pattern.name} - Savo Mode Pattern`;
                img.style.cssText = `
                    max-width: 80%;
                    max-height: 60%;
                    border: 3px solid #00d2ff;
                    border-radius: 10px;
                    box-shadow: 0 15px 40px rgba(0, 210, 255, 0.4);
                    cursor: pointer;
                `;

                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                    background: rgba(0, 0, 0, 0.95); display: flex; flex-direction: column;
                    justify-content: center; align-items: center; z-index: 10000; padding: 20px;
                `;

                modal.innerHTML = `
                    <div style="color: white; text-align: center; margin-bottom: 30px;">
                        <h2 style="color: #00d2ff; margin-bottom: 10px;">${pattern.name}</h2>
                        <p>Long press image → "Save Image"</p>
                        <p style="color: #00d2ff; font-size: 0.9rem;">800×600 pixels</p>
                    </div>
                    <button onclick="document.body.removeChild(this.closest('.saved-pattern-modal'))" style="
                        background: rgba(255,255,255,0.1); border: 2px solid #00d2ff; color: #00d2ff;
                        padding: 10px 20px; border-radius: 25px; cursor: pointer; margin-top: 30px;
                    ">Close</button>
                `;

                const closeButton = modal.querySelector('button');
                modal.insertBefore(img, closeButton);
                modal.className = 'saved-pattern-modal';
                document.body.appendChild(modal);

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) document.body.removeChild(modal);
                });

                this.showNotification(`${pattern.name} ready to save!`, 'success');
            }

            drawPatternTexture(ctx, pattern, width, height) {
                // Add some visual texture based on pattern type
                const colors = pattern.colors;
                ctx.globalAlpha = 0.3;

                if (pattern.environment === 'splash' || pattern.type === 'splash') {
                    // Draw splash camo blobs
                    for (let i = 0; i < 50; i++) {
                        const x = Math.random() * width;
                        const y = Math.random() * height;
                        const radius = Math.random() * 60 + 20;
                        ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                        ctx.beginPath();
                        ctx.ellipse(x, y, radius, radius * 0.6, Math.random() * Math.PI, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                } else {
                    // Draw organic forest shapes
                    for (let i = 0; i < 100; i++) {
                        const x = Math.random() * width;
                        const y = Math.random() * height;
                        const size = Math.random() * 40 + 10;
                        ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        for (let j = 0; j < 6; j++) {
                            const angle = (j * Math.PI) / 3;
                            const px = x + Math.cos(angle) * size * (0.5 + Math.random() * 0.5);
                            const py = y + Math.sin(angle) * size * (0.5 + Math.random() * 0.5);
                            ctx.lineTo(px, py);
                        }
                        ctx.closePath();
                        ctx.fill();
                    }
                }
                ctx.globalAlpha = 1;
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 25px;
                    border-radius: 10px;
                    color: white;
                    font-weight: 500;
                    z-index: 1000;
                    max-width: 400px;
                    backdrop-filter: blur(10px);
                `;

                const colors = {
                    success: 'background: linear-gradient(135deg, #2ecc71, #27ae60);',
                    error: 'background: linear-gradient(135deg, #e74c3c, #c0392b);',
                    info: 'background: linear-gradient(135deg, #3498db, #2980b9);',
                    warning: 'background: linear-gradient(135deg, #f39c12, #e67e22);'
                };

                notification.style.cssText += colors[type] || colors.info;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 4000);
            }
        }

        // Initialize the pattern manager
        const patternManager = new PatternManager();

        // Global functions for onclick handlers
        function generatePreview() {
            patternManager.updatePreview();
        }

        function savePattern() {
            patternManager.savePattern();
        }

        function randomizeColors() {
            patternManager.randomizeColors();
        }

        function loadNikeForestColors() {
            // Nike Forest Camo colors extracted from your image
            const nikeColors = ['#4a6741', '#5c7a52', '#3d5436', '#7cff50', '#2d4027'];
            
            nikeColors.forEach((color, index) => {
                document.getElementById(`color${index + 1}`).value = color;
            });
            
            patternManager.updatePreview();
            patternManager.showNotification('Loaded Nike Forest Camo colors!', 'success');
        }

        function selectPatternStyle(styleType) {
            document.getElementById('patternType').value = styleType;
            
            // Highlight selected pattern card
            document.querySelectorAll('.pattern-example-card').forEach(card => {
                card.style.borderColor = 'rgba(255,255,255,0.2)';
                card.style.transform = 'scale(1)';
            });
            
            event.currentTarget.style.borderColor = '#00d2ff';
            event.currentTarget.style.transform = 'scale(1.05)';
            
            patternManager.updatePreview();
            patternManager.showNotification(`Selected ${styleType.replace('-', ' ')} pattern style`, 'info');
        }

        function filterPatterns(category) {
            patternManager.filterPatterns(category);
        }

        function searchPatterns(query) {
            patternManager.searchPatterns(query);
        }

        function exportAllPatterns() {
            patternManager.exportAllPatterns();
        }

        // Pattern Style Library Functions
        function viewPatternStyle(styleType) {
            // Create full-screen viewer modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;

            const patternData = getPatternStyleData(styleType);
            
            modal.innerHTML = `
                <div style="background: rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; text-align: center; max-width: 90vw; max-height: 90vh; overflow: auto;">
                    <h2 style="color: #00d2ff; margin-bottom: 20px; text-transform: capitalize;">${styleType.replace('-', ' ')} Pattern</h2>
                    <div style="width: 400px; height: 300px; background: ${patternData.cssBackground}; border-radius: 10px; margin: 20px auto; border: 2px solid rgba(255,255,255,0.2);"></div>
                    <div style="margin-top: 20px;">
                        <button onclick="exportPatternStyle('${styleType}'); document.body.removeChild(this.closest('.pattern-modal'))" style="background: linear-gradient(135deg, #28a745, #20c997); border: none; color: white; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; margin-right: 10px;">Export PNG</button>
                        <button onclick="document.body.removeChild(this.closest('.pattern-modal'))" style="background: linear-gradient(135deg, #6c757d, #495057); border: none; color: white; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;

            modal.className = 'pattern-modal';
            document.body.appendChild(modal);

            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        function exportPatternStyle(styleType) {
            // Create canvas and draw pattern
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');
            drawPatternToCanvas(ctx, styleType, 800, 600);
            
            // Create the image element that acts like a Google image
            const img = document.createElement('img');
            img.src = canvas.toDataURL('image/png', 0.95);
            img.alt = `Savo Mode ${styleType.replace('-', ' ')} Pattern`;
            
            // Make it behave exactly like a Google image
            img.style.cssText = `
                max-width: 80%;
                max-height: 60%;
                border: 3px solid #00d2ff;
                border-radius: 10px;
                box-shadow: 0 15px 40px rgba(0, 210, 255, 0.4);
                cursor: pointer;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            `;
            
            // Create simple modal like Google image viewer
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.95);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            modal.innerHTML = `
                <div style="color: white; text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #00d2ff; margin-bottom: 10px;">
                        ${styleType.replace('-', ' ')} Pattern
                    </h2>
                    <p style="margin-bottom: 5px;">Long press image → "Save Image" or "Download Image"</p>
                    <p style="color: #00d2ff; font-size: 0.9rem;">800×600 pixels • Ready for your gallery</p>
                </div>
                <div style="text-align: center;">
                    <button onclick="document.body.removeChild(this.closest('.image-modal'))" style="
                        background: rgba(255,255,255,0.1);
                        border: 2px solid #00d2ff;
                        color: #00d2ff;
                        padding: 10px 20px;
                        border-radius: 25px;
                        cursor: pointer;
                        margin-top: 30px;
                        font-size: 1rem;
                    ">Close</button>
                </div>
            `;
            
            // Insert the downloadable image
            const closeButton = modal.querySelector('button');
            modal.insertBefore(img, closeButton);
            
            modal.className = 'image-modal';
            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
            
            patternManager.showNotification(`Long press the image to save to your device!`, 'success');
        }

        function getPatternStyleData(styleType) {
            const patterns = {
                'geometric': {
                    cssBackground: 'repeating-conic-gradient(from 45deg, #4a6741 0deg 45deg, #5c7a52 45deg 90deg, #3d5436 90deg 135deg, #7cff50 135deg 180deg)',
                    colors: ['#4a6741', '#5c7a52', '#3d5436', '#7cff50']
                },
                'pixelated': {
                    cssBackground: 'repeating-conic-gradient(#4a6741 0deg 90deg, #5c7a52 90deg 180deg, #3d5436 180deg 270deg, #7cff50 270deg 360deg)',
                    colors: ['#4a6741', '#5c7a52', '#3d5436', '#7cff50']
                },
                'organic': {
                    cssBackground: 'repeating-radial-gradient(ellipse, #4a6741 0px, #5c7a52 12px, #3d5436 24px, #7cff50 36px)',
                    colors: ['#4a6741', '#5c7a52', '#3d5436', '#7cff50']
                },
                'hex-pattern': {
                    cssBackground: 'repeating-conic-gradient(from 0deg at 50% 50%, #4a6741 0deg 60deg, #5c7a52 60deg 120deg, #3d5436 120deg 180deg, #7cff50 180deg 240deg, #2d4027 240deg 300deg, #4a6741 300deg 360deg)',
                    colors: ['#4a6741', '#5c7a52', '#3d5436', '#7cff50', '#2d4027']
                }
            };

            return patterns[styleType] || patterns['geometric'];
        }

        function drawPatternToCanvas(ctx, styleType, width, height) {
            const patternData = getPatternStyleData(styleType);
            const colors = patternData.colors;

            ctx.fillStyle = colors[0];
            ctx.fillRect(0, 0, width, height);

            switch (styleType) {
                case 'geometric':
                    drawGeometricPattern(ctx, colors, width, height);
                    break;
                case 'pixelated':
                    drawPixelatedPattern(ctx, colors, width, height);
                    break;
                case 'organic':
                    drawOrganicPattern(ctx, colors, width, height);
                    break;
                case 'hex-pattern':
                    drawHexPattern(ctx, colors, width, height);
                    break;
                default:
                    drawGeometricPattern(ctx, colors, width, height);
            }
        }

        function drawGeometricPattern(ctx, colors, width, height) {
            const size = 36;
            for (let x = 0; x < width; x += size) {
                for (let y = 0; y < height; y += size) {
                    const colorIndex = Math.floor(Math.random() * colors.length);
                    ctx.fillStyle = colors[colorIndex];
                    
                    // Draw geometric triangular shapes
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x + size/2, y + size/2);
                    ctx.lineTo(x, y + size);
                    ctx.closePath();
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.moveTo(x + size, y);
                    ctx.lineTo(x + size/2, y + size/2);
                    ctx.lineTo(x + size, y + size);
                    ctx.closePath();
                    ctx.fill();
                }
            }
        }

        function drawPixelatedPattern(ctx, colors, width, height) {
            const size = 24;
            for (let x = 0; x < width; x += size) {
                for (let y = 0; y < height; y += size) {
                    const colorIndex = Math.floor(Math.random() * colors.length);
                    ctx.fillStyle = colors[colorIndex];
                    ctx.fillRect(x, y, size, size);
                }
            }
        }

        function drawOrganicPattern(ctx, colors, width, height) {
            for (let i = 0; i < 200; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const radius = Math.random() * 30 + 10;
                const colorIndex = Math.floor(Math.random() * colors.length);
                
                ctx.fillStyle = colors[colorIndex];
                ctx.beginPath();
                ctx.ellipse(x, y, radius, radius * 0.6, Math.random() * Math.PI, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        function drawHexPattern(ctx, colors, width, height) {
            const size = 40;
            for (let x = 0; x < width; x += size * 0.75) {
                for (let y = 0; y < height; y += size * 0.866) {
                    const colorIndex = Math.floor(Math.random() * colors.length);
                    ctx.fillStyle = colors[colorIndex];
                    
                    // Draw hexagon
                    ctx.beginPath();
                    for (let i = 0; i < 6; i++) {
                        const angle = (i * Math.PI) / 3;
                        const hx = x + Math.cos(angle) * size/2;
                        const hy = y + Math.sin(angle) * size/2;
                        if (i === 0) ctx.moveTo(hx, hy);
                        else ctx.lineTo(hx, hy);
                    }
                    ctx.closePath();
                    ctx.fill();
                }
            }
        }
    </script>
</body>
</html>